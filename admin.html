<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Executive Admin | Rocky House</title>
    
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700&family=Inter:wght@300;400;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">

    <style>
        /* --- LUXURY COLOR PALETTE --- */
        :root { 
            --gold: #f39c12; 
            --onyx: #0a0a0a; 
            --white: #ffffff; 
            --glass: rgba(255, 255, 255, 0.05); 
            --sidebar-width: 280px; 
            --transition: 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }

        /* --- GLOBAL RESET --- */
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: 'Inter', sans-serif; 
            background: #050505; 
            color: var(--white); 
            min-height: 100vh; 
            overflow-x: hidden; 
        }

        /* --- NAVIGATION & SIDEBAR --- */
        .menu-toggle { 
            position: fixed; top: 20px; left: 20px; z-index: 2000; 
            background: var(--gold); color: black; border: none; 
            padding: 10px 12px; border-radius: 5px; cursor: pointer; 
            display: block; 
        }

        .sidebar { 
            width: var(--sidebar-width); background: var(--onyx); 
            border-right: 1px solid rgba(255,255,255,0.05); padding: 30px 20px; 
            display: flex; flex-direction: column; position: fixed; 
            height: 100vh; left: -100%; transition: var(--transition); z-index: 1500; 
        }

        .sidebar.active { left: 0; }

        .admin-brand { display: flex; align-items: center; gap: 12px; margin-bottom: 40px; padding-top: 40px; }
        .admin-logo-img { width: 42px; height: 42px; object-fit: contain; }

        /* --- BRAND TEXT WITH LOGO GRADIENT --- */
        .brand-text { 
            font-family: 'Playfair Display', serif; 
            font-size: 1.1rem; 
            line-height: 1.1; 
            letter-spacing: 1.5px;
            font-weight: 700;
            text-transform: uppercase;
            /* Gradient matching your swan logo (Orange to Magenta/Purple) */
            background: linear-gradient(to right, #f39c12, #e67e22, #9b59b6, #8e44ad);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            display: inline-block;
        }

        .brand-text span { 
            display: block; 
            font-family: 'Inter', sans-serif; 
            font-size: 0.55rem; 
            letter-spacing: 3px; 
            margin-top: 4px; 
            font-weight: 600; 
            text-transform: uppercase;
            /* Ensures "of Essentials" uses the same logo colors */
            background: inherit;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .nav-list { list-style: none; }
        .nav-item { padding: 15px; color: #888; text-decoration: none; font-size: 0.95rem; display: flex; align-items: center; gap: 15px; transition: 0.3s; border-radius: 8px; margin-bottom: 8px; cursor: pointer; }
        .nav-item:hover, .nav-item.active { background: var(--glass); color: var(--gold); }

        /* --- MAIN LAYOUT --- */
        .main-content { padding: 80px 20px 40px; width: 100%; transition: var(--transition); }
        .header h1 { font-family: 'Playfair Display', serif; font-size: 1.8rem; margin-bottom: 5px; }
        .header p { font-size: 0.7rem; color: #555; letter-spacing: 2px; text-transform: uppercase; }

        /* --- STAT CARDS --- */
        .stats-grid { display: grid; grid-template-columns: 1fr; gap: 15px; margin: 30px 0; }
        .stat-card { background: var(--onyx); padding: 20px; border: 1px solid rgba(255,255,255,0.05); border-radius: 12px; }
        .stat-card h4 { font-size: 0.6rem; color: #666; text-transform: uppercase; letter-spacing: 1px; margin-bottom: 5px; }
        .stat-card p { font-size: 1.4rem; font-weight: 600; color: var(--gold); }
        .cat-detail { font-size: 0.75rem; color: #888; display: flex; justify-content: space-between; margin-top: 5px;}

        /* --- UPLOAD BOX --- */
        .admin-box { background: var(--onyx); border-radius: 12px; padding: 20px; border: 1px solid rgba(255,255,255,0.05); }
        .upload-area { border: 2px dashed #333; padding: 30px; text-align: center; border-radius: 8px; margin: 20px 0; cursor: pointer; transition: 0.3s; }
        .upload-area:hover { border-color: var(--gold); background: rgba(243, 156, 18, 0.05); }
        
        #imagePreview { width: 100%; max-width: 250px; border-radius: 8px; display: none; margin: 0 auto; border: 1px solid var(--gold); box-shadow: 0 5px 15px rgba(0,0,0,0.5); }

        .form-group { margin-bottom: 15px; }
        input, select { width: 100%; padding: 12px; background: #000; border: 1px solid #222; color: white; border-radius: 6px; outline: none; }
        input:focus { border-color: var(--gold); }

        /* --- DATA TABLE --- */
        .table-container { margin-top: 30px; overflow-x: auto; }
        table { width: 100%; min-width: 500px; border-collapse: collapse; }
        th { text-align: left; color: #444; font-size: 0.65rem; padding: 15px; border-bottom: 1px solid #222; text-transform: uppercase; }
        td { padding: 12px 15px; border-bottom: 1px solid #111; font-size: 0.8rem; vertical-align: middle; }
        .img-preview { width: 45px; height: 45px; border-radius: 4px; object-fit: cover; border: 1px solid #333; }
        .delete-btn { color: #ff4444; background: none; border: none; cursor: pointer; font-size: 1rem; transition: 0.2s; }
        .delete-btn:hover { transform: scale(1.2); color: #ff6666; }

        @media (min-width: 1024px) {
            .menu-toggle { display: none; }
            .sidebar { left: 0; }
            .main-content { margin-left: var(--sidebar-width); padding: 40px; }
            .stats-grid { grid-template-columns: repeat(3, 1fr); }
            .form-row { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
        }
    </style>
</head>
<body>

    <button class="menu-toggle" onclick="toggleMenu()"><i class="fas fa-bars"></i></button>

    <aside class="sidebar" id="sidebar">
        <div class="admin-brand">
            <img src="logo.png" class="admin-logo-img" alt="Logo">
            <div class="brand-text">ROCKY HOUSE<span>of Essentials</span></div>
        </div>
        <nav class="nav-list">
            <a class="nav-item active"><i class="fas fa-box"></i> Dashboard</a>
            <a href="shop.html" class="nav-item"><i class="fas fa-shopping-bag"></i> View Shop</a>
            <a href="index.html" class="nav-item"><i class="fas fa-home"></i> Home Page</a>
            <a class="nav-item" onclick="logout()" style="margin-top: 30px; color: #ff4444;"><i class="fas fa-sign-out-alt"></i> Logout Admin</a>
        </nav>
    </aside>

    <main class="main-content">
        <header class="header">
            <h1>Executive Portal</h1>
            <p>Admin Control Panel</p>
        </header>

        <section class="stats-grid">
            <div class="stat-card">
                <h4>Total Essentials</h4>
                <p id="totalItems">0</p>
            </div>
            <div class="stat-card">
                <h4>Category Breakdown</h4>
                <div class="cat-detail"><span>Suits:</span> <span id="count-suit" style="color:var(--gold)">0</span></div>
                <div class="cat-detail"><span>Leisure:</span> <span id="count-collection" style="color:var(--gold)">0</span></div>
                <div class="cat-detail"><span>Solar:</span> <span id="count-solar" style="color:var(--gold)">0</span></div>
                <div class="cat-detail"><span>Books:</span> <span id="count-books" style="color:var(--gold)">0</span></div>
            </div>
            <div class="stat-card">
                <h4>Status</h4>
                <p id="cloudStatus" style="color: #666; font-size: 0.8rem;">● Waiting for Login</p>
            </div>
        </section>

        <section class="admin-box">
            <h2 style="font-family: 'Playfair Display'; margin-bottom: 20px;">Upload Content</h2>
            <form id="productForm">
                <div class="form-row">
                    <div class="form-group">
                        <label style="font-size: 0.7rem; color: #666; letter-spacing: 1px;">PRODUCT NAME</label>
                        <input type="text" id="pName" placeholder="Enter Title" required>
                    </div>
                    <div class="form-group">
                        <label style="font-size: 0.7rem; color: #666; letter-spacing: 1px;">CATEGORY</label>
                        <select id="pCat">
                            <option value="Signature Suits">Signature Suits</option>
                            <option value="Leisure Set">Leisure Set</option>
                            <option value="Solar Utilities">Solar Utilities</option>
                            <option value="Books">Books</option>
                        </select>
                    </div>
                </div>

                <div class="upload-area" onclick="document.getElementById('pImgFile').click()">
                    <div id="uploadUi">
                        <i class="fas fa-cloud-upload-alt" style="font-size: 2rem; color: var(--gold); margin-bottom: 10px;"></i>
                        <p style="font-size: 0.8rem; color: #888;">Tap to select product image</p>
                    </div>
                    <input type="file" id="pImgFile" accept="image/*" hidden onchange="previewImage(this)">
                    <img id="imagePreview" alt="Preview">
                </div>

                <button type="submit" id="submitBtn" style="background:var(--gold); color:black; border:none; width:100%; padding:15px; font-weight:700; border-radius:5px; cursor:pointer; letter-spacing: 1px; text-transform: uppercase;">Publish to House</button>
            </form>

            <div class="table-container">
                <table>
                    <thead><tr><th>Img</th><th>Name</th><th>Category</th><th>Action</th></tr></thead>
                    <tbody id="inventoryBody"></tbody>
                </table>
            </div>
        </section>
    </main>

    <script>
        const SB_URL = "https://yfunigwzprvbtbpxxpio.supabase.co"; 
        const SB_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InlmdW5pZ3d6cHJ2YnRicHh4cGlvIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzA4NzUyMTMsImV4cCI6MjA4NjQ1MTIxM30.-Bi0zWPS7cOYpY6nhWav0KvuI19Nb95BUfhRz80q2Nk";

        const _supabase = supabase.createClient(SB_URL, SB_KEY);

        function toggleMenu() { document.getElementById('sidebar').classList.toggle('active'); }
        function logout() { localStorage.removeItem('rocky_admin'); window.location.href="index.html"; }

        // --- AUTH CHECK ---
        window.addEventListener('load', () => {
            if(localStorage.getItem('rocky_admin') !== 'true') {
                let pass = prompt("Access Key Required:");
                if(pass === "rocky2026") { 
                    localStorage.setItem('rocky_admin', 'true');
                    loadProducts();
                } else { 
                    alert("Unauthorized Access.");
                    window.location.href = "index.html"; 
                }
            } else { 
                loadProducts(); 
            }
        });

        let selectedFile = null;
        function previewImage(input) {
            const preview = document.getElementById('imagePreview');
            const ui = document.getElementById('uploadUi');
            if (input.files && input.files[0]) {
                selectedFile = input.files[0];
                const reader = new FileReader();
                reader.onload = (e) => {
                    preview.src = e.target.result;
                    preview.style.display = "block";
                    ui.style.display = "none";
                };
                reader.readAsDataURL(selectedFile);
            }
        }

        async function loadProducts() {
            const status = document.getElementById('cloudStatus');
            try {
                const { data, error } = await _supabase.from('essentials').select('*').order('created_at', { ascending: false });
                if (error) throw error;
                
                status.innerText = "● Live & Secured";
                status.style.color = "#00ff7f";
                
                document.getElementById('totalItems').innerText = data.length;
                const counts = { "Signature Suits": 0, "Leisure Set": 0, "Solar Utilities": 0, "Books": 0 };
                data.forEach(p => { if(counts[p.Category] !== undefined) counts[p.Category]++; });

                document.getElementById('count-suit').innerText = counts["Signature Suits"];
                document.getElementById('count-collection').innerText = counts["Leisure Set"];
                document.getElementById('count-solar').innerText = counts["Solar Utilities"];
                document.getElementById('count-books').innerText = counts["Books"];

                document.getElementById('inventoryBody').innerHTML = data.map(p => `
                    <tr>
                        <td><img src="${p.image_url}" class="img-preview"></td>
                        <td>${p.Name}</td>
                        <td style="color:#666; font-size:0.7rem;">${p.Category.toUpperCase()}</td>
                        <td><button class="delete-btn" onclick="deleteProduct('${p.id}')"><i class="fas fa-trash-alt"></i></button></td>
                    </tr>
                `).join('');
            } catch (err) { 
                status.innerText = "● Sync Error";
                status.style.color = "red";
                console.error(err);
            }
        }

        document.getElementById('productForm').onsubmit = async (e) => {
            e.preventDefault();
            const btn = document.getElementById('submitBtn');
            if(!selectedFile) return alert("Please select an image first.");

            btn.disabled = true;
            btn.innerText = "PUBLISHING TO HOUSE...";

            try {
                const fileName = `${Date.now()}-${selectedFile.name.replace(/\s/g, '_')}`;
                
                // 1. Upload to Storage
                const { error: upErr } = await _supabase.storage.from('product-images').upload(fileName, selectedFile);
                if(upErr) throw upErr;

                // 2. Get Public URL
                const { data: urlData } = _supabase.storage.from('product-images').getPublicUrl(fileName);
                
                // 3. Insert into Table
                const { error: dbErr } = await _supabase.from('essentials').insert([{
                    Name: document.getElementById('pName').value,
                    Category: document.getElementById('pCat').value,
                    image_url: urlData.publicUrl
                }]);

                if(dbErr) throw dbErr;
                alert("Masterpiece Published.");
                location.reload();
            } catch (err) {
                alert("Upload Failed: " + err.message);
            } finally {
                btn.disabled = false;
                btn.innerText = "PUBLISH TO HOUSE";
            }
        };

        async function deleteProduct(id) {
            if(confirm("Permanently remove this item?")) {
                const { error } = await _supabase.from('essentials').delete().eq('id', id);
                if (error) alert("Action failed");
                else loadProducts();
            }
        }
    </script>
</body>
</html>
